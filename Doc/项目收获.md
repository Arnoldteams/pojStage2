大家可以在这个文档写自己遇到的问题和解决方案

---

# git 使用

## 常规流程

1. 如果本地有新写的数据需要先add，commit 到本地仓库

2. pull 最新的代码版本
3. 如果存在冲突，需要处理
4. <span style='color:red'>**一定要保证运行不报错**</span> 再push 推送自己的代码到远程仓库



## 冲突处理

1. 删除掉git提示冲突的符号,文字 >>> ，结合 Alt + Shift + f 全局搜索
2. 修改语法问题，调整到可以运行的状态



# 数据校验

## 手机号

位数11，不含字母，特定开头



## 商品相关

如价格，库存，数量，销量，等

应该为大于0的数字



## 特殊搜索

如查询id，应该校验输入的必须为数字



## 校验场景

- 增
	- 注册，添加数据

- 删

- 改

- 搜索



# 数据库问题

## 旧数据冲突

如果手动删除数据库A表的一条数据，要考虑与这条关联的数据是否需要删除

例如，删除一条用户数据，对应这个用户的优惠券信息没删，在注册新用户时，如果id和以前相同，就会给这个用户一张本应该存在的券



## 初始化数据

如果存在deleted类似的字段，设计字段应该不为空

如果设计的可以为空，写sql语句时要考虑三种状态，null，0，≠0，尤其注意null条件的处理





## 设计表

不要使用外键，使用逻辑保证数据之间的关系





## sql语句

### 数据库注入

用户输入的数据，需要考虑数据库注入问题，使用 `${ }`



### 必要字段

注意数据库，一些字段必要的默认值



### 关联问题

注意数据表直接关联，增删改，可能对应多表的修改



# 项目搭建

## Maven

Maven要修改路径为本地的仓库路径

注意.idea/workspace.xml 中的Maven配置

本地仓库中的脏数据及时清理 .lastupdated .part .lock



## 编码格式

统一编码格式



## 运行时未知bug

先重新部署试试



# 技术栈

## Spring



## SpringMVC

### 异常处理

程序的异常信息不应该直接显示给用户，应该给用户一个合理的响应

### 类型转换



### AOP

AspectJ

### 文件上传

- 使用 springboot 自带的文件上传依赖。

- 使用 MultipartFile 接收 post 请求的 file 参数

  - 注意设置上传文件的大小参数修改，否则只有 1MB

  - ```
    spring:
      # Sssd 配置上传文件大小
      servlet:
        multipart:
          max-file-size: 100MB
          max-request-size: 1000MB
    ```

- 生成文件名 使用 UUID
- 拼接映射地址：用于存储数据库
- 使用 transferTo 方法把文件存入实际地址 

## SpringBoot

### 依赖

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <!-- version 标签里的值就是SpringBoot应用程序的版本 -->
        <version>2.7.1</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.cskaoyan</groupId>
    <artifactId>mall40</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>mall40</name>
    <description>Demo project for Spring Boot</description>

    <properties>
        <java.version>1.8</java.version>
    </properties>
    <dependencies>

        <!-- SpringBoot     -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>

        <!-- Mybatis       -->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>2.2.2</version>
        </dependency>

        <!-- 数据库连接池      -->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid</artifactId>
            <version>1.2.8</version>
        </dependency>

        <!-- 默认使用mysql8，需要指定版本号       -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.47</version>
        </dependency>

        <!-- 数据库查询分页      -->
        <dependency>
            <groupId>com.github.pagehelper</groupId>
            <artifactId>pagehelper-spring-boot-starter</artifactId>
            <version>1.4.1</version>
        </dependency>

        <!-- 添加自定义文件提示      -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-configuration-processor</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- lombok 提供get，set方法       -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!--工具包，判断为空，去除括号-->
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-lang3</artifactId>
        </dependency>

        <!-- 文件上传 -->
        <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
            <version>1.4</version>
        </dependency>

        <!--Aspect方法增强-->
        <dependency>
            <groupId>org.aspectj</groupId>
            <artifactId>aspectjweaver</artifactId>
            <version>1.9.7</version>
        </dependency>

        <!-- 单元测试     -->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.13</version>
            <scope>test</scope>
        </dependency>

        <!--shiro依赖-->
        <dependency>
            <groupId>org.apache.shiro</groupId>
            <artifactId>shiro-spring</artifactId>
            <version>1.7.1</version>
        </dependency>

        <!--redis-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
            <version>2.3.12.RELEASE</version>
        </dependency>

        <!--提供 StringUtils -->
        <dependency>
            <groupId>commons-beanutils</groupId>
            <artifactId>commons-beanutils</artifactId>
            <version>1.9.4</version>
        </dependency>

        <!--数据校验 -->
        <dependency>
            <groupId>org.hibernate.validator</groupId>
            <artifactId>hibernate-validator</artifactId>
        </dependency>

        <!--oss 阿里云的对象存储 -->
        <dependency>
            <groupId>com.aliyun.oss</groupId>
            <artifactId>aliyun-sdk-oss</artifactId>
            <version>2.5.0</version>
        </dependency>

        <!--sms 阿里云的短信接口服务-->
        <dependency>
            <groupId>com.aliyun</groupId>
            <artifactId>aliyun-java-sdk-core</artifactId>
            <version>4.0.3</version>
        </dependency>
        
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>

```



### 配置文件

```yml
# server.port: 配置Tomcat端口号
# server.servlet.context-path: 配置应用名
server:
  port: 8083
  servlet:
    context-path: /

# 静态资源映射
# spring.mvc.static-path-pattern: 相对路径
# spring.resources 或 spring.web.resources: 本地路径
# 配置数据源
# spring.datasource.* :配置数据源
spring:
  mvc:
    static-path-pattern: /pic/**
  web:
    resources:
      static-locations: file:d:/spring/
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://localhost:3306/mydb?useUnicode=true&characterEncoding=utf-8&allowMultiQueries=true
    username: root
    password: 123456
    type: com.alibaba.druid.pool.DruidDataSource
  redis:
    host: 43.138.55.158
    port: 6379
    lettuce:
      shutdown-timeout: 0

  # Sssd 配置上传文件大小
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 1000MB


# 配置Mybatis
# mybatis.configuration.cache-enabled: 开启缓存
mybatis:
  configuration:
    cache-enabled: true
  # Sssd typeHandler 哦欸之
  type-handlers-package: com.cskaoyan.typehandler


# 配置自动分页
pagehelper:
  helper-dialect: mysql

# 配置日志
logging:
  level:
    com.cskaoyan.mapper: debug

# 配置异常日志路径
com:
  cskaoyan:
    logPath: D://log.txt


# sms 配置阿里云，使用验证码服务需要提供密钥
aliyun:
  accessKeyId: LTAI5t8gpxPTCR6W58RnZq4u
  accessKeySecret: mVPbpbxia0JQotb7HyJAREV8QUuq8h
  oss:
    bucket: cskaoyan
    endPoint: oss-cn-beijing.aliyuncs.com
  sms:
    signName: stone4j
    templateCode: SMS_173765187
```



### 数据校验



### 单元测试

需要添加注解

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = MarketApplication.class)
```



## Mybatis

### 逆向工程

根据数据库的表，生成bean，XxxMapper.xml，XxxMapper.java 文件

<span style="color:red">注意:</span> 生成的内容也有可能是有问题的，表的字段可能是sql关键词，需要手动添加 `` `



### 分页

```java
// 配置分页工具 -- 这行代码要写在mapper方法前
PageHelper.startPage(baseParam.getPage(),baseParam.getLimit());
List<MarketBrand> marketBrands = marketBrandMapper.selectByExample(example)
```



### 异步

1. 数据更新



## Redis

### 应用场景

1. 验证码

	发送验证码对应一个HandlerMethod，如果在注册，登陆业务对应的业务使用到这个验证码，有4种存储选择 Session ，Cookie，ServletContext，Redis

	Session域需要同一个id，不能指定Attriubte过期，如果全部过期会影响登陆状态

	Cookie存储在客户端，不够安全

	ServletContext 也不能设置过期

	综上，使用Redis更合理

2. 数据库更新



### 对象存储



## Shiro



## 自定义注解



## 反射

如果需要使用大量的get、set方法时，可以考虑反射；反射可以灵活的根据你传入的Class对象来调用对应的get，set方法



## 验证码

没什么技术含量，主要流程是，

你购买一个发短信的服务，阿里云提供接口，调用这个接口传入一个字符串+手机号，阿里云帮你发给对应的手机

验证码是自己写的java程序生成的

但是要考虑到，发验证码和使用验证码的方法不同；验证码需要设置过期，因此使用Redis存储比较合适

# 问题&Bug

<span style='color:red'>**不要嫌问题小就不记录了，这都是你的宝贵经验**</span>

## 报错导包失败

> 解决方案：
>
> 检查项目的编码是否统一 utf-8
>
> 配置本地Maven路径 
>
> 清理本地仓库脏数据



## 逆向工程不识别相对路径

配置运行的相对目录 为 %MODULE_WORKING_DIR%



## 报错sql语法错误

使用逆向工程生成的sql语句包含关键词的列名，需要手动添加飘号

可能涉及到 Mapper.xml 和 example 方法



## 误报问题

使用Spring注入，idea可能识别不到组件，实际已经注入到容器里，会误报但可以运行

在配置文件中也可能存在



## 注入失败

忘记在Service上添加 @Service 注解了









